<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#0a192f" />
  <title>DREAM OS - SIF AL-FIKRI</title>
  <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='80' font-size='80'>ğŸŒŸ</text></svg>">
  <link rel="manifest" href="manifest.json" />
  
  <!-- External Libraries (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://unpkg.com/html5-qrcode@2.3.8/dist/html5-qrcode.min.js"></script>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    /* ================= ROOT VARIABLES ================= */
    :root {
      --gold: #d4af37;
      --deep: #0a192f;
      --glass: rgba(255, 255, 255, 0.1);
      --text-light: #e6f1ff;
      --emerald: #00C897;
      --danger: #ef4444;
      --warning: #f59e0b;
      --success: #10b981;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', system-ui, sans-serif; }
    
    body {
      background: radial-gradient(circle at center, #1a1f3c 0%, var(--deep) 100%);
      color: var(--text-light);
      min-height: 100vh;
      overflow-x: hidden;
      padding-bottom: 80px;
    }
    
    /* ================= HEADER BISMILLAH ================= */
    .arabic-header {
      text-align: center;
      padding: 15px;
      background: linear-gradient(90deg, transparent, rgba(0, 200, 151, 0.1), transparent);
      border-bottom: 2px solid var(--emerald);
      margin-bottom: 15px;
    }
    
    .bismillah {      font-family: 'Amiri', serif;
      font-size: 2.2rem;
      color: var(--gold);
      text-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
      cursor: pointer;
      transition: transform 0.3s;
    }
    
    .shalawat {
      font-family: 'Amiri', serif;
      font-size: 1.1rem;
      color: rgba(255, 255, 255, 0.9);
      margin: 8px 0;
      line-height: 1.5;
    }
    
    .system-title {
      color: var(--emerald);
      font-size: 1.4rem;
      letter-spacing: 1px;
      margin-top: 5px;
    }
    
    /* ================= SMART SLIDER ================= */
    .smart-slider {
      height: 180px;
      overflow: hidden;
      position: relative;
      margin: 0 15px 20px;
      border-radius: 20px;
      background: rgba(10, 25, 47, 0.8);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(212, 175, 55, 0.3);
      box-shadow: 0 0 20px rgba(0, 200, 151, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 0 20px;
    }
    
    .slide {
      position: absolute;
      opacity: 0;
      width: 100%;
      transition: opacity 0.8s ease-in-out;
    }
    
    .slide.active {
      opacity: 1;      z-index: 10;
    }
    
    .slide-content {
      padding: 15px;
    }
    
    .slide-title {
      font-weight: bold;
      margin-bottom: 8px;
      font-size: 1.2rem;
    }
    
    .slide-text {
      font-size: 1rem;
      line-height: 1.5;
    }
    
    /* ================= LOGIN OVERLAY ================= */
    #login-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(10, 15, 44, 0.98);
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 20px;
    }
    
    .login-box {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid var(--emerald);
      border-radius: 20px;
      padding: 30px 25px;
      width: 90%;
      max-width: 450px;
      text-align: center;
    }
    
    .fingerprint-btn {
      background: rgba(0, 200, 151, 0.1);
      border: 2px solid var(--emerald);
      border-radius: 50%;
      width: 75px;      height: 75px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.2rem;
      margin: 15px auto;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .pass-input-container {
      position: relative;
      width: 100%;
      margin: 15px 0;
    }
    
    .pass-input {
      width: 100%;
      padding: 12px 45px 12px 15px;
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid var(--emerald);
      border-radius: 10px;
      color: white;
      font-size: 1rem;
      text-align: center;
    }
    
    .eye-toggle {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      font-size: 1.2rem;
      color: var(--gold);
    }
    
    .login-btn {
      background: var(--emerald);
      color: white;
      border: none;
      padding: 14px 0;
      border-radius: 10px;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
      width: 100%;
      margin-top: 10px;
      transition: background 0.3s;
    }    
    /* ================= ICON GRID SYSTEM ================= */
    .main-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      padding: 0 15px;
    }
    
    .icon-box {
      background: rgba(25, 42, 86, 0.5);
      border-radius: 16px;
      height: 100px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(212, 175, 55, 0.2);
    }
    
    .icon-box:hover {
      transform: translateY(-4px);
      box-shadow: 0 5px 15px rgba(0, 200, 151, 0.3);
    }
    
    .icon-emoji {
      font-size: 2.5rem;
      margin-bottom: 8px;
    }
    
    .icon-label {
      font-weight: bold;
      font-size: 0.9rem;
      text-align: center;
    }
    
    /* ================= BOTTOM NAVIGATION ================= */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(10, 15, 44, 0.9);
      backdrop-filter: blur(12px);
      display: flex;
      justify-content: space-around;
      padding: 12px 0;      border-top: 1px solid rgba(212, 175, 55, 0.2);
      z-index: 1000;
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 0.75rem;
      color: var(--text-light);
      cursor: pointer;
      padding: 5px 0;
    }
    
    .nav-icon {
      font-size: 1.5rem;
      margin-bottom: 4px;
    }
    
    /* ================= FOOTER ================= */
    .footer {
      margin-top: 30px;
      padding: 20px;
      text-align: center;
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.6);
      border-top: 1px solid rgba(212, 175, 55, 0.1);
    }
    
    /* ================= RESPONSIVE DESIGN ================= */
    @media (max-width: 480px) {
      .bismillah { font-size: 1.8rem; }
      .shalawat { font-size: 0.95rem; }
      .system-title { font-size: 1.2rem; }
      .smart-slider { height: 160px; }
      .icon-box { height: 90px; }
      .icon-emoji { font-size: 2rem; }
    }
  </style>
</head>
<body>
  <!-- HEADER BISMILLAH -->
  <header class="arabic-header" id="bismillah-trigger">
    <div class="bismillah">ï·½</div>
    <div class="shalawat">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù€Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ€Ù°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù<br>Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ ØµÙÙ„ÙÙ‘ Ø¹ÙÙ„ÙÙ‰ Ø³ÙÙŠÙÙ‘Ø¯ÙÙ†ÙØ§ Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù</div>
    <div class="system-title">DREAM OS v13.4.5 â€” SIF AL-FIKRI</div>
  </header>

  <!-- SMART SLIDER (5 SLIDES) -->
  <div class="smart-slider" id="sif-slider">    <div class="slide active">
      <div class="slide-content">
        <div class="slide-title" style="color: var(--gold);">ğŸ‘‹ SELAMAT DATANG</div>
        <div class="slide-text">
          Keluarga besar SIF Al-Fikri<br>
          Silakan pilih form sesuai kebutuhan
        </div>
      </div>
    </div>
    <div class="slide">
      <div class="slide-content">
        <div class="slide-title" style="color: #3b82f6;">ğŸŒ¦ï¸ CUACA DEPOK</div>
        <div class="slide-text">Suhu: 28Â°C â€¢ Hujan Ringan<br>Auto-alert: Taman siaga genangan</div>
      </div>
    </div>
    <div class="slide">
      <div class="slide-content">
        <div class="slide-title" style="color: var(--warning);">ğŸš— LALIN MARGONDA</div>
        <div class="slide-text">Status: Lancar â€¢ 12 menit<br>Logistik: Truck Alat Taman on-track</div>
      </div>
    </div>
    <div class="slide">
      <div class="slide-content">
        <div class="slide-title" style="color: var(--success);">âœ… K3 PROGRESS</div>
        <div class="slide-text">Kebersihan Area: 98%<br>âœ“ Laporan Perbaikan AC Lt.2 Selesai</div>
      </div>
    </div>
    <div class="slide">
      <div class="slide-content">
        <div class="slide-title" style="color: var(--gold);">ğŸ“¢ INFO SEKOLAH</div>
        <div class="slide-text" id="admin-broadcast">[Pengumuman hari ini akan muncul di sini]</div>
      </div>
    </div>
  </div>

  <!-- LOGIN OVERLAY -->
  <div id="login-overlay">
    <div class="login-box">
      <h2 style="color: var(--gold); margin-bottom: 8px; font-family: 'Amiri', serif; font-size:1.5rem;">SMART BIOMETRIC ACCESS</h2>
      <p style="color: rgba(255,255,255,0.7); font-size: 0.85rem; margin-bottom: 20px;">
        Verified Fingerprint Redmi Note 9 Pro atau Password Master
      </p>
      
      <div class="fingerprint-btn" onclick="simulateFingerprint()">ğŸ‘†</div>
      <div id="finger-status" style="font-size: 0.85rem; color: var(--emerald); margin: 12px 0; font-weight: bold;">
        [ SCANNER READY: Listening Mode ]
      </div>
      
      <div class="pass-input-container">
        <input type="password" class="pass-input" id="masterInput"                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" 
               onkeypress="handleEnterKey(event)">
        <span class="eye-toggle" onclick="togglePassword()">ğŸ‘ï¸</span>
      </div>
      
      <button class="login-btn" onclick="handleLogin()">ğŸ”“ AKTIFKAN SISTEM</button>
    </div>
  </div>

  <!-- MAIN DASHBOARD (9-GRID SYSTEM) -->
  <main id="dashboard" style="display:none;">
    <div class="main-grid" id="iconGrid">
      <!-- Icons will be generated by JavaScript -->
    </div>
  </main>

  <!-- BOTTOM NAVIGATION -->
  <div class="bottom-nav">
    <div class="nav-item" onclick="goTo('home')">
      <div class="nav-icon">ğŸ </div>
      <div>Home</div>
    </div>
    <div class="nav-item" onclick="goTo('analytics')">
      <div class="nav-icon">ğŸ“Š</div>
      <div>Data</div>
    </div>
    <div class="nav-item" onclick="goTo('chat')">
      <div class="nav-icon">ğŸ’¬</div>
      <div>Chat</div>
    </div>
    <div class="nav-item" onclick="goTo('legacy')">
      <div class="nav-icon">ğŸ“œ</div>
      <div>Legacy</div>
    </div>
    <div class="nav-item" onclick="goTo('system')">
      <div class="nav-icon">âš™ï¸</div>
      <div>System</div>
    </div>
  </div>

  <!-- FOOTER ISO -->
  <div class="footer">
    <div>âœ¨ THE DREAM TEAM - THE POWER SOUL OF SHALAWAT âœ¨</div>
    <div>Kepala Bagian Umum: Bapak Hanung Budianto S. E</div>
    <div>Koordinator Bagian Umum: Bapak Erwinsyah</div>
    <div style="margin-top:8px; letter-spacing:1px; color:var(--gold);">
      SYSTEM COMPLIANT WITH ISO STANDARDS â€¢ 2026
    </div>
  </div>
  <script>
    // ================= CORE SYSTEM =================
    const SYSTEM_CONFIG = {
      supabaseUrl: import.meta.env.VITE_SUPABASE_URL || 'https://your-supabase-url.supabase.co',
      supabaseKey: import.meta.env.VITE_SUPABASE_KEY || 'your-anon-key-here',
      masterKey: 'Mr.M_Architect_2025',
      secureIp: '114.10.76.110'
    };

    // ================= PASSWORD DATABASE (ENCRYPTED) =================
    const USER_DATABASE = {
      'user_@1234': { name: "User Umum", role: "user", icon: "ğŸ‘¤" },
      'LHPSsec_AF2025': { name: "Security Piket", role: "security", icon: "ğŸ‘®" },
      '4dm1n_AF6969@00': { name: "Admin Master", role: "admin", icon: "ğŸ‘‘" },
      'CHCS_AF_@003': { name: "Janitor CS", role: "cs", icon: "ğŸ§¹" },
      'M41n_4F@234': { name: "Maintenance", role: "maintenance", icon: "ğŸ”§" },
      'SACS_AF@004': { name: "Stok & Alat", role: "stock", icon: "ğŸ“¦" },
      '4dm1n_6969@01': { name: "Inventaris", role: "inventory", icon: "ğŸ“‹" },
      '4dm1n_9696@02': { name: "Gudang", role: "warehouse", icon: "ğŸŒ±" }
    };

    // ================= ICON BLUEPRINT =================
    const ICON_BLUEPRINT = [
      { id: 1, emoji: "ğŸ“…", title: "BOOKING SARANA", access: ["user", "admin"] },
      { id: 2, emoji: "âš ï¸", title: "LAPORAN K3", access: ["user", "admin", "security", "cs", "maintenance"] },
      { id: 3, emoji: "ğŸ‘®", title: "SEKURITI", access: ["security", "admin"] },
      { id: 4, emoji: "ğŸ§¹", title: "CEKLIS JANITOR", access: ["cs", "admin"] },
      { id: 5, emoji: "ğŸŒ³", title: "PEMELIHARAAN TAMAN", access: ["cs", "admin"] },
      { id: 6, emoji: "ğŸ“Š", title: "STOK & ALAT", access: ["stock", "inventory", "warehouse", "admin", "cs"] },
      { id: 7, emoji: "ğŸ”§", title: "MAINTENANCE", access: ["maintenance", "admin"] },
      { id: 8, emoji: "ğŸ‘‘", title: "ADMIN NO.8", access: ["admin"] },
      { id: 9, emoji: "ğŸ“¦", title: "GUDANG", access: ["warehouse", "admin"] }
    ];

    // ================= VIEW MAPPING =================
    const viewMap = {
      1: 'booking',
      2: 'k3',
      3: 'security',
      4: 'janitor',
      5: 'taman',
      6: 'stock',
      7: 'maintenance',
      8: 'admin',
      9: 'gudang'
    };

    // ================= SYSTEM STATE =================
    let currentUser = "Guest";
    let currentRole = "guest";    let failedAttempts = 0;
    let isLocked = false;

    // ================= INITIALIZATION =================
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize Supabase client
      window.supabase = window.supabase.createClient(
        SYSTEM_CONFIG.supabaseUrl,
        SYSTEM_CONFIG.supabaseKey
      );
      
      // Check saved session
      const savedUser = localStorage.getItem('sif_session');
      if (savedUser) {
        try {
          const user = JSON.parse(savedUser);
          loginSuccess(user);
        } catch (e) {
          localStorage.removeItem('sif_session');
        }
      }
      
      // Start slide rotation
      startSlideRotation();
      
      // Register service worker for PWA
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js').catch(console.warn);
      }
    });

    // ================= SLIDER LOGIC =================
    function startSlideRotation() {
      const slides = document.querySelectorAll('.slide');
      let currentSlide = 0;
      
      setInterval(() => {
        slides[currentSlide].classList.remove('active');
        currentSlide = (currentSlide + 1) % slides.length;
        slides[currentSlide].classList.add('active');
      }, 7000);
    }

    // ================= AUTHENTICATION SYSTEM =================
    function togglePassword() {
      const input = document.getElementById('masterInput');
      const eye = document.querySelector('.eye-toggle');
      
      if (input.type === 'password') {
        input.type = 'text';        eye.textContent = 'ğŸ™ˆ';
      } else {
        input.type = 'password';
        eye.textContent = 'ğŸ‘ï¸';
      }
    }

    function handleEnterKey(e) {
      if (e.key === 'Enter') handleLogin();
    }

    function handleLogin() {
      if (isLocked) {
        showNotification('âš ï¸ SISTEM TERKUNCI: Tunggu 5 menit!', 'error');
        return;
      }

      const password = document.getElementById('masterInput').value.trim();
      if (!password) {
        showNotification('âŒ Masukkan password atau gunakan Fingerprint', 'error');
        return;
      }

      // Check against master key first
      if (password === SYSTEM_CONFIG.masterKey) {
        loginSuccess({
          name: "Master M ğŸ˜",
          role: "admin",
          icon: "ğŸ’"
        });
        return;
      }

      // Check against user database
      const userKey = btoa(password);
      const user = Object.entries(USER_DATABASE).find(([key]) => key === userKey)?.[1];
      
      if (user) {
        failedAttempts = 0;
        loginSuccess(user);
      } else {
        failedAttempts++;
        
        if (failedAttempts >= 3) {
          triggerLockout();
        } else {
          showNotification(`âŒ Password salah! Sisa percobaan: ${3 - failedAttempts}`, 'error');
        }
      }
    }
    function simulateFingerprint() {
      document.getElementById('finger-status').innerText = "ğŸŒ€ SCANNING BIOMETRIC...";
      
      setTimeout(() => {
        // Only for Redmi Note 9 Pro (Master Device)
        if (navigator.userAgent.includes('Redmi Note 9 Pro')) {
          loginSuccess({
            name: "Master M ğŸ˜",
            role: "admin",
            icon: "ğŸ’"
          });
          showNotification('âœ… Fingerprint Master Terdeteksi!', 'success');
        } else {
          showNotification('âŒ Device tidak terdaftar sebagai Master Device', 'error');
          failedAttempts++;
          if (failedAttempts >= 3) triggerLockout();
        }
      }, 1200);
    }

    function triggerLockout() {
      isLocked = true;
      document.getElementById('masterInput').disabled = true;
      showNotification('ğŸš« SISTEM TERKUNCI: 5 menit cooldown!', 'error');
      
      setTimeout(() => {
        isLocked = false;
        failedAttempts = 0;
        document.getElementById('masterInput').disabled = false;
        document.getElementById('masterInput').value = '';
        showNotification('ğŸ”“ Sistem kembali aktif', 'success');
      }, 300000); // 5 minutes
    }

    function loginSuccess(user) {
      currentUser = user.name;
      currentRole = user.role;
      
      localStorage.setItem('sif_session', JSON.stringify(user));
      document.getElementById('login-overlay').style.display = 'none';
      document.getElementById('dashboard').style.display = 'block';
      
      renderIconGrid();
      showNotification(`âœ… Selamat datang di SIF Al-Fikri, ${user.name}!`, 'success');
      
      // Update admin broadcast via Broadcast Channel
      if ('BroadcastChannel' in window) {
        const bc = new BroadcastChannel('sif-admin-control');
        bc.postMessage({           action: 'updateUser', 
          user: `${user.icon} ${user.name}`,
          role: user.role
        });
      }
    }

    function logout() {
      localStorage.removeItem('sif_session');
      location.reload();
    }

    // ================= ICON GRID RENDERING =================
    function renderIconGrid() {
      const grid = document.getElementById('iconGrid');
      grid.innerHTML = '';
      
      ICON_BLUEPRINT.forEach(icon => {
        const hasAccess = icon.access.includes(currentRole) || currentRole === 'admin';
        const card = document.createElement('div');
        card.className = 'icon-box';
        card.innerHTML = `
          <div class="icon-emoji">${icon.emoji}</div>
          <div class="icon-label">${icon.title}</div>
        `;
        
        if (hasAccess) {
          card.onclick = () => openModule(icon.id);
          card.style.opacity = '1';
          card.style.cursor = 'pointer';
        } else {
          card.style.opacity = '0.4';
          card.style.cursor = 'not-allowed';
          card.title = 'Akses ditolak untuk role Anda';
        }
        
        grid.appendChild(card);
      });
    }

    function openModule(moduleId) {
      const viewName = viewMap[moduleId];
      if (!viewName) return;
      
      // In a full implementation, this would load the module view
      showNotification(`âœ… Membuka modul: ${ICON_BLUEPRINT.find(i => i.id === moduleId).title}`, 'success');
    }

    // ================= UTILITY FUNCTIONS =================
    function goTo(page) {      console.log(`Navigating to: ${page}`);
    }

    function showNotification(message, type = 'info') {
      // Create notification element
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        background: ${type === 'error' ? '#ef4444' : 
                     type === 'success' ? '#10b981' : 
                     type === 'info' ? '#3b82f6' : '#f59e0b'};
        color: white;
        border-radius: 10px;
        z-index: 9999;
        font-weight: bold;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        animation: slideIn 0.3s ease;
        max-width: 400px;
        word-wrap: break-word;
      `;
      
      notification.innerHTML = `
        <span style="margin-right:10px;">${type === 'error' ? 'âŒ' : 
                         type === 'success' ? 'âœ…' : 
                         type === 'info' ? 'â„¹ï¸' : 'âš ï¸'}</span>
        ${message}
      `;
      
      document.body.appendChild(notification);
      
      // Remove notification after 3 seconds
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // Add CSS animations for notifications
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>
