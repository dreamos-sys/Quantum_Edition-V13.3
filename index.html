<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DREAM OS v13.3 ‚Äî Supabase Integrated 7-Icon System</title>
    
    <!-- SUPABASE CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.4/dist/umd/supabase.min.js"></script>
    
    <!-- FAVICON -->
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAApElEQVQ4jWNkYGBg+A8lGcDAwMDAwMTAwMDEwMDADAQMDMiAEU4woRCM/5EAAwMDAyMDAwMjkkpGBgYGBkYGBiYkAYgizAwoKhlR3GJE4w0mNF5gQmN9JjTmZURyCxOcRvIq3N2MyIow5Np/qJ9Z0Fj0P2YU/zOi9wMDThrNC4z/6dEL6GJGJyoDAwMDAxMAhgSEBx43VpYAAAAASUVORK5CYII=">
    
    <style>
        :root {
            --emerald: #00C897;
            --gold: #FFD700;
            --dark: #0A0F2C;
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --blue: #3b82f6;
            --purple: #8b5cf6;
            --ghost-bg: rgba(10, 15, 44, 0.95);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0A0F2C 0%, #1a1f3c 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        /* HEADER BISMILLAH */
        .header {
            text-align: center;
            padding: 25px 0;
            background: linear-gradient(90deg, transparent, rgba(0, 200, 151, 0.2), transparent);
            border-bottom: 2px solid var(--emerald);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, var(--gold), var(--emerald));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(0, 200, 151, 0.3);
            letter-spacing: 2px;
        }

        .header .subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-top: 10px;
        }

        /* PASSWORD OVERLAY */
        .password-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 15, 44, 0.98);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s;
        }

        .password-box {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--emerald);
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 500px;
            text-align: center;
        }

        .password-input {
            position: relative;
            margin: 25px 0;
        }

        .password-input input {
            width: 100%;
            padding: 18px 60px 18px 25px;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid var(--emerald);
            border-radius: 15px;
            color: white;
            font-size: 1.2rem;
            letter-spacing: 1px;
        }

        .toggle-password {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gold);
            cursor: pointer;
            font-size: 1.4rem;
            padding: 5px;
        }

        /* ICON GRID */
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 25px;
            margin: 40px 0;
            opacity: 0;
            transform: translateY(30px);
            transition: all 1s ease;
        }

        .icon-grid.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .icon-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px 20px;
            text-align: center;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.4s;
            position: relative;
            overflow: hidden;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .icon-card:hover {
            border-color: var(--emerald);
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 200, 151, 0.25);
        }

        .icon-card.ghost {
            opacity: 0.25;
            filter: blur(4px);
            cursor: not-allowed;
        }

        .icon-card.unlocked {
            opacity: 1;
            filter: none;
            cursor: pointer;
            background: rgba(0, 200, 151, 0.08);
        }

        .icon-card.active {
            border-color: var(--gold);
            background: rgba(255, 215, 0, 0.1);
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.3);
        }

        .icon-emoji {
            font-size: 3.5rem;
            margin-bottom: 20px;
            display: block;
            transition: transform 0.3s;
        }

        .icon-card:hover .icon-emoji {
            transform: scale(1.2);
        }

        .icon-title {
            font-size: 1.1rem;
            color: white;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .icon-desc {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.4;
        }

        .password-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.5);
            color: var(--gold);
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 10px;
            border: 1px solid var(--gold);
        }

        /* FORM MODAL */
        .form-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 15, 44, 0.95);
            backdrop-filter: blur(15px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }

        .form-modal.active {
            display: flex;
            animation: fadeIn 0.5s;
        }

        .form-container {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--emerald);
            border-radius: 25px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--emerald);
        }

        .form-title {
            font-size: 1.8rem;
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--danger);
            font-size: 2.5rem;
            cursor: pointer;
            line-height: 1;
            padding: 0 10px;
        }

        .form-group {
            margin: 20px 0;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-submit {
            background: var(--emerald);
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: background 0.3s;
        }

        .form-submit:hover {
            background: #00b386;
        }

        /* DASHBOARD CARDS */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--emerald);
        }

        .stat-icon {
            font-size: 2.5rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 200, 151, 0.1);
            border-radius: 12px;
        }

        .stat-info {
            flex: 1;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--emerald);
        }

        .stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .stat-sub {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
        }

        /* NOTIFICATION */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            background: rgba(0, 200, 151, 0.1);
            border: 1px solid var(--emerald);
            color: white;
            z-index: 3000;
            display: none;
            align-items: center;
            gap: 10px;
            max-width: 400px;
            animation: slideInRight 0.3s ease;
        }

        .notification.show {
            display: flex;
        }

        .notification.error {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--danger);
        }

        .notification.warning {
            background: rgba(245, 158, 11, 0.1);
            border-color: var(--warning);
        }

        .notification.success {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--success);
        }

        /* ANIMATIONS */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 200, 151, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(0, 200, 151, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 200, 151, 0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* SCROLLBAR */
        .form-container::-webkit-scrollbar {
            width: 8px;
        }

        .form-container::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }

        .form-container::-webkit-scrollbar-thumb {
            background: var(--emerald);
            border-radius: 10px;
        }

        /* FOOTER */
        .footer {
            text-align: center;
            margin-top: 60px;
            padding: 25px;
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.85rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* CONNECTION STATUS */
        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1000;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
        }

        .connection-status.online {
            color: var(--success);
            border: 1px solid var(--success);
        }

        .connection-status.offline {
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .icon-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .icon-card {
                min-height: 160px;
                padding: 20px 15px;
            }
            
            .icon-emoji {
                font-size: 2.8rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .icon-grid {
                grid-template-columns: 1fr;
            }
            
            .password-box {
                padding: 25px;
            }
        }
    </style>
</head>
<body>

    <!-- NOTIFICATION SYSTEM -->
    <div class="notification" id="notification">
        <span id="notificationIcon">‚ÑπÔ∏è</span>
        <span id="notificationText">Notification</span>
    </div>

    <!-- CONNECTION STATUS -->
    <div class="connection-status offline" id="connectionStatus">
        <span id="connectionIcon">üì¥</span>
        <span id="connectionText">Offline Mode</span>
    </div>

    <!-- PASSWORD OVERLAY (UNTUK MASUK KE SISTEM) -->
    <div class="password-overlay" id="masterOverlay">
        <div class="password-box">
            <div style="font-size: 3.5rem; margin-bottom: 20px;">üîê</div>
            <h2 style="color: var(--emerald); margin-bottom: 10px;">DREAM OS v13.3 - Supabase Edition</h2>
            <p style="color: rgba(255,255,255,0.7); margin-bottom: 30px;">
                Masukkan Password Master untuk mengakses sistem
            </p>
            
            <div class="password-input">
                <input type="password" id="masterPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                <button class="toggle-password" onclick="togglePassword('masterPassword', this)">üëÅÔ∏è</button>
            </div>
            
            <button class="form-submit" onclick="checkMasterPassword()" style="margin-top: 10px;">
                üîì MASUK KE SISTEM
            </button>
            
            <div id="masterError" style="color: var(--danger); margin-top: 20px; display: none; font-size: 0.9rem;">
                ‚ùå Password salah! Password Master: Mr.M_Architect_2025
            </div>
            
            <div style="margin-top: 30px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px;">
                <div style="color: var(--gold); font-size: 0.9rem; font-weight: bold; margin-bottom: 10px;">üìã Password Referensi:</div>
                <div style="font-size: 0.8rem; color: rgba(255,255,255,0.6); line-height: 1.6;">
                    ‚Ä¢ Master: Mr.M_Architect_2025<br>
                    ‚Ä¢ Admin: 4dm1n_AF6969@00<br>
                    ‚Ä¢ Ghost: 418626<br>
                    ‚Ä¢ CS: jan_AF-@003<br>
                    ‚Ä¢ Stok CS: CS_stkAF@004<br>
                    ‚Ä¢ Maintenance: Main_AF@234
                </div>
            </div>

            <div style="margin-top: 20px; padding: 15px; background: rgba(59, 130, 246, 0.1); border-radius: 10px; border: 1px solid rgba(59, 130, 246, 0.3);">
                <div style="color: #3b82f6; font-size: 0.9rem; font-weight: bold; margin-bottom: 10px;">üöÄ Supabase Connected</div>
                <div style="font-size: 0.75rem; color: rgba(255,255,255,0.6); line-height: 1.4;">
                    Real-time Database: <span id="supabaseStatus" style="color: var(--success);">üü¢ Active</span><br>
                    Version: 13.3 ‚Ä¢ Tables: 5 ‚Ä¢ API: Ready
                </div>
            </div>
        </div>
    </div>

    <!-- HEADER BISMILLAH -->
    <div class="header" id="mainHeader" style="display: none;">
        <h1>Ô∑Ω Bismillah Shalawat</h1>
        <div class="subtitle">DREAM OS v13.3 ‚Äî Supabase Integrated 7-Icon System</div>
        <div style="margin-top: 15px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
            <span style="background: rgba(0,200,151,0.1); padding: 5px 15px; border-radius: 20px; font-size: 0.8rem;">
                üóÑÔ∏è Supabase Database
            </span>
            <span style="background: rgba(59,130,246,0.1); padding: 5px 15px; border-radius: 20px; font-size: 0.8rem;">
                üîÑ Real-time Sync
            </span>
            <span style="background: rgba(139,92,246,0.1); padding: 5px 15px; border-radius: 20px; font-size: 0.8rem;">
                üì± Offline Support
            </span>
        </div>
    </div>

    <!-- DASHBOARD SECTION -->
    <div id="dashboardSection" style="display: none; margin: 40px 0;">
        <h2 style="color: var(--gold); margin-bottom: 20px; text-align: center;">üìä Live Dashboard</h2>
        <div class="dashboard-grid" id="dashboardGrid">
            <!-- Stats will be loaded here -->
        </div>
    </div>

    <!-- 7-ICON GRID -->
    <div class="icon-grid" id="iconGrid" style="display: none;">
        <!-- ICON 1: BOOKING SARANA -->
        <div class="icon-card ghost" data-id="1" data-password="user_@1234" onclick="unlockIcon(1)">
            <div class="password-badge">üîí</div>
            <span class="icon-emoji">üìÖ</span>
            <div class="icon-title">BOOKING SARANA</div>
            <div class="icon-desc">
                Booking 22 sarana Al-Fikri ‚Ä¢ Real-time availability ‚Ä¢ Supabase sync
            </div>
        </div>

        <!-- ICON 2: LAPORAN K3 -->
        <div class="icon-card ghost" data-id="2" data-password="user_@1234" onclick="unlockIcon(2)">
            <div class="password-badge">üîí</div>
            <span class="icon-emoji">üõ°Ô∏è</span>
            <div class="icon-title">LAPORAN K3</div>
            <div class="icon-desc">
                Kerusakan ‚Üí Maintenance<br>
                Kehilangan ‚Üí Sekuriti<br>
                Kebersihan ‚Üí CS
            </div>
        </div>

        <!-- ICON 3: LAPORAN SEKURITI -->
        <div class="icon-card ghost" data-id="3" data-password="sec_AF2025" onclick="unlockIcon(3)">
            <div class="password-badge">üîí</div>
            <span class="icon-emoji">üëÆ</span>
            <div class="icon-title">LAPORAN SEKURITI</div>
            <div class="icon-desc">
                Petugas 3 orang ‚Ä¢ Shift Pagi/Malam<br>
                Kontrol harian + Excel export
            </div>
        </div>

        <!-- ICON 4: ADMIN PANEL -->
        <div class="icon-card ghost" data-id="4" data-password="4dm1n_AF6969@00" onclick="unlockIcon(4)">
            <div class="password-badge">üîí</div>
            <span class="icon-emoji">üëë</span>
            <div class="icon-title">ADMIN PANEL</div>
            <div class="icon-desc">
                Akses penuh sistem ‚Ä¢ Device fingerprint<br>
                Supabase management ‚Ä¢ User control
            </div>
        </div>

        <!-- ICON 5: JANITOR / CS -->
        <div class="icon-card ghost" data-id="5" data-password="jan_AF-@003" onclick="unlockIcon(5)">
            <div class="password-badge">üîí</div>
            <span class="icon-emoji">üßπ</span>
            <div class="icon-title">JANITOR / CS</div>
            <div class="icon-desc">
                Ceklis harian kebersihan ‚Ä¢ Area monitoring<br>
                Supabase real-time updates
            </div>
        </div>

        <!-- ICON 6: MAINTENANCE -->
        <div class="icon-card ghost" data-id="6" data-password="Main_AF@234" onclick="unlockIcon(6)">
            <div class="password-badge">üîí</div>
            <span class="icon-emoji">üîß</span>
            <div class="icon-title">MAINTENANCE</div>
            <div class="icon-desc">
                Perbaikan sarana ‚Ä¢ Status tracking<br>
                Real-time updates to Supabase
            </div>
        </div>

        <!-- ICON 7: STOK CS -->
        <div class="icon-card ghost" data-id="7" data-password="CS_stkAF@004" onclick="unlockIcon(7)">
            <div class="password-badge">üîí</div>
            <span class="icon-emoji">üì¶</span>
            <div class="icon-title">STOK CS</div>
            <div class="icon-desc">
                Stok & tools kebersihan ‚Ä¢ Inventory management<br>
                Auto-sync with Supabase
            </div>
        </div>
    </div>

    <!-- FORM MODAL (UNTUK SEMUA FORM) -->
    <div class="form-modal" id="formModal">
        <div class="form-container" id="formContainer">
            <!-- Konten form akan dimuat di sini via JavaScript -->
        </div>
    </div>

    <!-- FOOTER -->
    <div class="footer" id="mainFooter" style="display: none;">
        <div>DREAM OS v13.3 ‚Äî Supabase Quantum Edition</div>
        <div style="margin-top: 10px; font-size: 0.75rem; color: rgba(255,255,255,0.3);">
            7-Icon Supabase System ‚Ä¢ Real-time Database ‚Ä¢ Offline Support ‚Ä¢ Bismillah Shalawat Engine
        </div>
        <div style="margin-top: 5px; font-size: 0.7rem; color: rgba(0,200,151,0.5);">
            Supabase Connected: <span id="footerStatus">üü¢ Active</span> ‚Ä¢ Tables: 5 ‚Ä¢ API: Ready
        </div>
    </div>

    <script>
        // ================= SUPABASE CONFIGURATION =================
        const SUPABASE_CONFIG = {
            url: 'https://ywtpykgjvbjwhmapmygb.supabase.co',
            anonKey: 'sb_publishable_bdhuNnP4kr_pxoJ3cVJBaA_3Tyz0Dii',
            serviceRoleKey: 'sb_secret_wK9-X957AE-0jlBj2GAzkg_31Vaa5D0',
            jwtToken: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl3dHB5a2dqdmJqd2htYXBteWdiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5MTI5OTcsImV4cCI6MjA4MjQ4ODk5N30.MA78j8WLwOO9nxR36tikN7jBQLjbYWYvTZn___eXBkk'
        };

        // ================= PASSWORD CONFIGURATION =================
        const PASSWORDS = {
            MASTER: "Mr.M_Architect_2025",
            USER: "user_@1234",
            SECURITY: "sec_AF2025",
            ADMIN: "4dm1n_AF6969@00",
            GHOST: "418626",
            JANITOR: "jan_AF-@003",
            STOK_CS: "CS_stkAF@004",
            MAINTENANCE: "Main_AF@234"
        };

        // ================= GLOBAL STATE =================
        let supabase = null;
        let isConnected = false;
        let unlockedIcons = [];
        let currentIconId = null;
        let currentUser = null;
        let offlineQueue = [];
        let dashboardStats = {
            bookings: { today: 0, pending: 0, total: 0 },
            k3: { open: 0, resolved: 0, total: 0 },
            security: { today: 0, total: 0 },
            inventory: { ready: 0, in_use: 0, need_fix: 0 }
        };

        // ================= NOTIFICATION SYSTEM =================
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const icon = document.getElementById('notificationIcon');
            const text = document.getElementById('notificationText');
            
            // Set icon based on type
            const icons = {
                'info': '‚ÑπÔ∏è',
                'success': '‚úÖ',
                'error': '‚ùå',
                'warning': '‚ö†Ô∏è'
            };
            
            icon.textContent = icons[type] || '‚ÑπÔ∏è';
            text.textContent = message;
            
            // Set class
            notification.className = 'notification show';
            notification.classList.add(type);
            
            // Auto hide
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ================= SUPABASE INITIALIZATION =================
        async function initializeSupabase() {
            try {
                // Create Supabase client
                supabase = window.supabase.createClient(
                    SUPABASE_CONFIG.url,
                    SUPABASE_CONFIG.anonKey,
                    {
                        auth: {
                            autoRefreshToken: true,
                            persistSession: false
                        },
                        global: {
                            headers: {
                                'Authorization': `Bearer ${SUPABASE_CONFIG.jwtToken}`
                            }
                        }
                    }
                );

                // Test connection
                const { data, error } = await supabase.from('users').select('count').limit(1);
                
                if (error) throw error;
                
                isConnected = true;
                updateConnectionStatus(true);
                showNotification('‚úÖ Supabase connected successfully!', 'success');
                
                // Setup real-time subscriptions
                setupRealtimeSubscriptions();
                
                // Load dashboard stats
                loadDashboardStats();
                
                // Sync any offline data
                syncOfflineData();
                
                return true;
            } catch (error) {
                console.error('‚ùå Supabase connection failed:', error);
                isConnected = false;
                updateConnectionStatus(false);
                showNotification('‚ö†Ô∏è Offline mode activated. Data will be saved locally.', 'warning');
                return false;
            }
        }

        function updateConnectionStatus(connected) {
            const statusEl = document.getElementById('connectionStatus');
            const iconEl = document.getElementById('connectionIcon');
            const textEl = document.getElementById('connectionText');
            const footerStatus = document.getElementById('footerStatus');
            
            if (connected) {
                statusEl.className = 'connection-status online';
                iconEl.textContent = 'üì°';
                textEl.textContent = 'Online (Supabase)';
                if (footerStatus) footerStatus.textContent = 'üü¢ Active';
            } else {
                statusEl.className = 'connection-status offline';
                iconEl.textContent = 'üì¥';
                textEl.textContent = 'Offline Mode';
                if (footerStatus) footerStatus.textContent = 'üî¥ Offline';
            }
        }

        // ================= REALTIME SUBSCRIPTIONS =================
        function setupRealtimeSubscriptions() {
            if (!supabase || !isConnected) return;

            // Subscribe to bookings changes
            supabase
                .channel('bookings-channel')
                .on('postgres_changes', 
                    { event: '*', schema: 'public', table: 'bookings' },
                    (payload) => {
                        console.log('üîÑ Real-time booking update:', payload);
                        showNotification('üìÖ Booking data updated in real-time', 'info');
                        loadDashboardStats();
                    }
                )
                .subscribe();

            // Subscribe to K3 reports
            supabase
                .channel('k3-channel')
                .on('postgres_changes',
                    { event: '*', schema: 'public', table: 'k3_reports' },
                    (payload) => {
                        console.log('üîÑ Real-time K3 update:', payload);
                        showNotification('üõ°Ô∏è K3 report updated', 'info');
                        loadDashboardStats();
                    }
                )
                .subscribe();
        }

        // ================= DASHBOARD FUNCTIONS =================
        async function loadDashboardStats() {
            if (!isConnected) {
                // Load from localStorage if offline
                loadOfflineStats();
                return;
            }

            try {
                const today = new Date().toISOString().split('T')[0];
                
                // Get today's bookings
                const { data: todayBookings } = await supabase
                    .from('bookings')
                    .select('*', { count: 'exact' })
                    .eq('booking_date', today);
                
                // Get pending bookings
                const { data: pendingBookings } = await supabase
                    .from('bookings')
                    .select('*', { count: 'exact' })
                    .eq('status', 'pending');
                
                // Get open K3 reports
                const { data: openK3 } = await supabase
                    .from('k3_reports')
                    .select('*', { count: 'exact' })
                    .eq('status', 'open');
                
                // Get security reports for today
                const { data: todaySecurity } = await supabase
                    .from('security_reports')
                    .select('*', { count: 'exact' })
                    .gte('timestamp', `${today}T00:00:00`)
                    .lte('timestamp', `${today}T23:59:59`);
                
                // Update dashboard stats
                dashboardStats = {
                    bookings: {
                        today: todayBookings?.length || 0,
                        pending: pendingBookings?.length || 0,
                        total: 0 // Could be fetched separately
                    },
                    k3: {
                        open: openK3?.length || 0,
                        resolved: 0,
                        total: 0
                    },
                    security: {
                        today: todaySecurity?.length || 0,
                        total: 0
                    },
                    inventory: {
                        ready: 0,
                        in_use: 0,
                        need_fix: 0
                    }
                };
                
                renderDashboard();
                
            } catch (error) {
                console.error('Failed to load dashboard stats:', error);
                loadOfflineStats();
            }
        }

        function loadOfflineStats() {
            // Load from localStorage
            const bookings = JSON.parse(localStorage.getItem('dreamos_bookings') || '[]');
            const k3Reports = JSON.parse(localStorage.getItem('dreamos_k3_reports') || '[]');
            const today = new Date().toISOString().split('T')[0];
            
            const todayBookings = bookings.filter(b => b.booking_date === today);
            const pendingBookings = bookings.filter(b => b.status === 'pending');
            const openK3 = k3Reports.filter(k => k.status === 'open');
            
            dashboardStats = {
                bookings: {
                    today: todayBookings.length,
                    pending: pendingBookings.length,
                    total: bookings.length
                },
                k3: {
                    open: openK3.length,
                    resolved: 0,
                    total: k3Reports.length
                },
                security: {
                    today: 0,
                    total: 0
                },
                inventory: {
                    ready: 0,
                    in_use: 0,
                    need_fix: 0
                }
            };
            
            renderDashboard();
        }

        function renderDashboard() {
            const dashboardGrid = document.getElementById('dashboardGrid');
            if (!dashboardGrid) return;
            
            dashboardGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-info">
                        <div class="stat-value">${dashboardStats.bookings.today}</div>
                        <div class="stat-label">Booking Hari Ini</div>
                        <div class="stat-sub">${dashboardStats.bookings.pending} menunggu</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üõ°Ô∏è</div>
                    <div class="stat-info">
                        <div class="stat-value">${dashboardStats.k3.open}</div>
                        <div class="stat-label">Laporan K3 Terbuka</div>
                        <div class="stat-sub">Perlu perhatian</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üëÆ</div>
                    <div class="stat-info">
                        <div class="stat-value">${dashboardStats.security.today}</div>
                        <div class="stat-label">Laporan Security</div>
                        <div class="stat-sub">Hari ini</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üì¶</div>
                    <div class="stat-info">
                        <div class="stat-value">${dashboardStats.inventory.ready}</div>
                        <div class="stat-label">Inventaris Ready</div>
                        <div class="stat-sub">${dashboardStats.inventory.in_use} dipakai</div>
                    </div>
                </div>
            `;
        }

        // ================= OFFLINE SUPPORT =================
        function saveOffline(table, data) {
            const offlineData = {
                ...data,
                is_offline: true,
                offline_id: `offline_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                created_at: new Date().toISOString()
            };

            // Save to localStorage
            const key = `dreamos_${table}_offline`;
            const existing = JSON.parse(localStorage.getItem(key) || '[]');
            existing.push(offlineData);
            localStorage.setItem(key, JSON.stringify(existing));

            // Add to sync queue
            offlineQueue.push({ table, data: offlineData });

            return { 
                success: true, 
                data: offlineData,
                message: 'Data disimpan offline, akan disinkronkan saat online'
            };
        }

        async function syncOfflineData() {
            if (!isConnected || offlineQueue.length === 0) return;

            showNotification('üîÑ Menyinkronkan data offline...', 'info');
            
            for (const item of [...offlineQueue]) {
                try {
                    const { table, data } = item;
                    
                    // Remove offline metadata
                    const { is_offline, offline_id, ...cleanData } = data;
                    
                    const { error } = await supabase
                        .from(table)
                        .insert([cleanData]);

                    if (!error) {
                        // Remove from queue and localStorage
                        offlineQueue = offlineQueue.filter(i => i.data.offline_id !== offline_id);
                        
                        const offlineKey = `dreamos_${table}_offline`;
                        const offlineData = JSON.parse(localStorage.getItem(offlineKey) || '[]');
                        const updatedData = offlineData.filter(i => i.offline_id !== offline_id);
                        localStorage.setItem(offlineKey, JSON.stringify(updatedData));
                        
                        console.log(`‚úÖ Synced ${table} item:`, offline_id);
                    }
                } catch (error) {
                    console.error('Failed to sync offline item:', error);
                }
            }
            
            showNotification('‚úÖ Data offline berhasil disinkronkan!', 'success');
            loadDashboardStats();
        }

        // ================= DATABASE FUNCTIONS =================
        async function saveToSupabase(table, data) {
            if (!isConnected) {
                return saveOffline(table, data);
            }

            try {
                const { data: result, error } = await supabase
                    .from(table)
                    .insert([data])
                    .select();

                if (error) throw error;
                
                // Also save to localStorage as backup
                saveToLocalStorage(table, result[0]);
                
                return { success: true, data: result[0] };
            } catch (error) {
                console.error(`Failed to save to ${table}:`, error);
                return saveOffline(table, data);
            }
        }

        function saveToLocalStorage(table, data) {
            const key = `dreamos_${table}`;
            const existing = JSON.parse(localStorage.getItem(key) || '[]');
            
            // Remove if exists (update)
            const filtered = existing.filter(item => item.id !== data.id);
            filtered.push(data);
            
            localStorage.setItem(key, JSON.stringify(filtered));
        }

        // ================= FORM SUBMISSION FUNCTIONS =================
        async function submitBookingForm(event) {
            event.preventDefault();
            
            const formData = {
                sarana_name: document.getElementById('bookingSarana').value,
                pic_name: document.getElementById('bookingPIC').value,
                pic_phone: document.getElementById('bookingPhone').value,
                booking_date: document.getElementById('bookingDate').value,
                start_time: document.getElementById('bookingStart').value,
                end_time: document.getElementById('bookingEnd').value,
                notes: document.getElementById('bookingNote').value,
                status: 'pending',
                user_role: 'user'
            };

            const result = await saveToSupabase('bookings', formData);
            
            if (result.success) {
                showNotification(result.message || '‚úÖ Booking berhasil disimpan!', 'success');
                loadDashboardStats();
                closeModal();
            } else {
                showNotification('‚ùå Gagal menyimpan booking!', 'error');
            }
        }

        async function submitK3Form(event) {
            event.preventDefault();
            
            const formData = {
                location: document.getElementById('k3Location').value,
                report_type: document.getElementById('k3Type').value,
                reporter_name: document.getElementById('k3Reporter').value,
                reporter_phone: document.getElementById('k3Phone').value,
                description: document.getElementById('k3Description').value,
                status: 'open',
                severity: 'medium',
                user_role: 'user'
            };

            const result = await saveToSupabase('k3_reports', formData);
            
            if (result.success) {
                showNotification(result.message || '‚úÖ Laporan K3 berhasil disimpan!', 'success');
                loadDashboardStats();
                closeModal();
            } else {
                showNotification('‚ùå Gagal menyimpan laporan K3!', 'error');
            }
        }

        async function submitSecurityForm(event) {
            event.preventDefault();
            
            const formData = {
                officer_name: document.getElementById('securityOfficer').value,
                shift: document.getElementById('securityShift').value,
                report_type: document.getElementById('securityType').value,
                location: document.getElementById('securityLocation').value,
                description: document.getElementById('securityDescription').value,
                status: 'submitted',
                user_role: 'security',
                timestamp: new Date().toISOString()
            };

            const result = await saveToSupabase('security_reports', formData);
            
            if (result.success) {
                showNotification(result.message || '‚úÖ Laporan Security berhasil disimpan!', 'success');
                loadDashboardStats();
                closeModal();
            } else {
                showNotification('‚ùå Gagal menyimpan laporan security!', 'error');
            }
        }

        async function submitCSForm(event) {
            event.preventDefault();
            
            const formData = {
                area: document.getElementById('csArea').value,
                cleaning_time: document.getElementById('csTime').value,
                condition: document.getElementById('csCondition').value,
                notes: document.getElementById('csNotes').value,
                status: 'completed',
                user_role: 'cs',
                timestamp: new Date().toISOString()
            };

            const result = await saveToSupabase('cs_reports', formData);
            
            if (result.success) {
                showNotification(result.message || '‚úÖ Ceklis CS berhasil disimpan!', 'success');
                closeModal();
            } else {
                showNotification('‚ùå Gagal menyimpan ceklis CS!', 'error');
            }
        }

        async function submitMaintenanceForm(event) {
            event.preventDefault();
            
            const formData = {
                item_name: document.getElementById('maintenanceItem').value,
                location: document.getElementById('maintenanceLocation').value,
                description: document.getElementById('maintenanceDescription').value,
                status: document.getElementById('maintenanceStatus').value,
                priority: 'medium',
                user_role: 'maintenance',
                reported_at: new Date().toISOString()
            };

            const result = await saveToSupabase('maintenance', formData);
            
            if (result.success) {
                showNotification(result.message || '‚úÖ Laporan Maintenance berhasil disimpan!', 'success');
                closeModal();
            } else {
                showNotification('‚ùå Gagal menyimpan laporan maintenance!', 'error');
            }
        }

        async function submitStockForm(event) {
            event.preventDefault();
            
            const formData = {
                item_name: document.getElementById('stockItem').value,
                category: document.getElementById('stockCategory').value,
                quantity: document.getElementById('stockQuantity').value,
                location: document.getElementById('stockLocation').value,
                min_stock: 5,
                current_stock: document.getElementById('stockQuantity').value,
                last_updated: new Date().toISOString(),
                user_role: 'cs'
            };

            const result = await saveToSupabase('inventory', formData);
            
            if (result.success) {
                showNotification(result.message || '‚úÖ Data stok berhasil disimpan!', 'success');
                closeModal();
            } else {
                showNotification('‚ùå Gagal menyimpan data stok!', 'error');
            }
        }

        // ================= UI FUNCTIONS =================
        function togglePassword(inputId, button) {
            const input = document.getElementById(inputId);
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'üëÅÔ∏è‚Äçüó®Ô∏è';
            } else {
                input.type = 'password';
                button.textContent = 'üëÅÔ∏è';
            }
        }

        function checkMasterPassword() {
            const input = document.getElementById('masterPassword');
            const errorDiv = document.getElementById('masterError');
            
            if (input.value === PASSWORDS.MASTER) {
                // UNLOCK SYSTEM
                document.getElementById('masterOverlay').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('masterOverlay').style.display = 'none';
                    document.getElementById('mainHeader').style.display = 'block';
                    document.getElementById('dashboardSection').style.display = 'block';
                    document.getElementById('iconGrid').style.display = 'grid';
                    document.getElementById('mainFooter').style.display = 'block';
                    
                    // Initialize Supabase
                    initializeSupabase();
                    
                    // Animasi muncul
                    setTimeout(() => {
                        document.getElementById('iconGrid').classList.add('visible');
                    }, 100);
                }, 500);
                
                showNotification('‚úÖ System unlocked! Welcome to DREAM OS v13.3', 'success');
                
            } else {
                // WRONG PASSWORD
                errorDiv.style.display = 'block';
                input.style.borderColor = 'var(--danger)';
                input.style.animation = 'shake 0.5s';
                
                setTimeout(() => {
                    input.style.animation = '';
                }, 500);
            }
        }

        function unlockIcon(iconId) {
            const icon = document.querySelector(`[data-id="${iconId}"]`);
            
            // Jika sudah unlock, langsung buka form
            if (unlockedIcons.includes(iconId)) {
                openForm(iconId);
                return;
            }
            
            // Jika belum, minta password
            currentIconId = iconId;
            const requiredPassword = icon.getAttribute('data-password');
            
            // Buat modal password untuk icon ini
            const passwordHTML = `
                <div class="form-header">
                    <div class="form-title">
                        <span style="font-size: 2rem;">${icon.querySelector('.icon-emoji').textContent}</span>
                        <div>
                            <div style="font-size: 1.5rem;">${icon.querySelector('.icon-title').textContent}</div>
                            <div style="font-size: 0.9rem; color: rgba(255,255,255,0.6);">Password Required</div>
                        </div>
                    </div>
                    <button class="close-modal" onclick="closeModal()">√ó</button>
                </div>
                
                <div style="text-align: center; margin: 30px 0;">
                    <div style="font-size: 5rem; margin-bottom: 20px;">üîê</div>
                    <p style="color: rgba(255,255,255,0.8); margin-bottom: 30px;">
                        Masukkan password untuk mengakses <strong>${icon.querySelector('.icon-title').textContent}</strong>
                    </p>
                    
                    <div class="password-input">
                        <input type="password" id="iconPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" style="font-size: 1.3rem; text-align: center;">
                        <button class="toggle-password" onclick="togglePassword('iconPassword', this)">üëÅÔ∏è</button>
                    </div>
                    
                    <button class="form-submit" onclick="checkIconPassword()" style="margin-top: 20px;">
                        üîì BUKA FORM
                    </button>
                    
                    <div id="iconPasswordError" style="color: var(--danger); margin-top: 20px; display: none;">
                        ‚ùå Password salah!
                    </div>
                </div>
            `;
            
            document.getElementById('formContainer').innerHTML = passwordHTML;
            document.getElementById('formModal').classList.add('active');
            
            // Auto focus
            setTimeout(() => {
                document.getElementById('iconPassword').focus();
            }, 300);
        }

        function checkIconPassword() {
            const input = document.getElementById('iconPassword');
            const errorDiv = document.getElementById('iconPasswordError');
            const icon = document.querySelector(`[data-id="${currentIconId}"]`);
            const requiredPassword = icon.getAttribute('data-password');
            
            if (input.value === requiredPassword) {
                // UNLOCK ICON
                unlockedIcons.push(currentIconId);
                icon.classList.remove('ghost');
                icon.classList.add('unlocked', 'pulse');
                
                // Remove badge
                icon.querySelector('.password-badge').textContent = '‚úÖ';
                
                // Close modal and open form
                setTimeout(() => {
                    closeModal();
                    icon.classList.remove('pulse');
                    openForm(currentIconId);
                }, 800);
                
            } else {
                // WRONG PASSWORD
                errorDiv.style.display = 'block';
                input.style.borderColor = 'var(--danger)';
                input.style.animation = 'shake 0.5s';
                
                setTimeout(() => {
                    input.style.animation = '';
                }, 500);
            }
        }

        function openForm(iconId) {
            const formTemplates = {
                1: getBookingForm(),
                2: getK3Form(),
                3: getSecurityForm(),
                4: getAdminForm(),
                5: getCSForm(),
                6: getMaintenanceForm(),
                7: getStockForm()
            };
            
            document.getElementById('formContainer').innerHTML = formTemplates[iconId];
            document.getElementById('formModal').classList.add('active');
            
            // Highlight icon yang aktif
            document.querySelectorAll('.icon-card').forEach(icon => {
                icon.classList.remove('active');
            });
            document.querySelector(`[data-id="${iconId}"]`).classList.add('active');
        }

        function closeModal() {
            document.getElementById('formModal').classList.remove('active');
            
            // Remove active class dari semua icon
            document.querySelectorAll('.icon-card').forEach(icon => {
                icon.classList.remove('active');
            });
        }

        // ================= FORM TEMPLATES =================
        function getBookingForm() {
            const today = new Date().toISOString().split('T')[0];
            return `
                <div class="form-header">
                    <div class="form-title">
                        <span style="font-size: 2rem;">üìÖ</span>
                        <div>BOOKING SARANA</div>
                    </div>
                    <button class="close-modal" onclick="closeModal()">√ó</button>
                </div>
                
                <form onsubmit="submitBookingForm(event)">
                    <div class="form-group">
                        <label class="form-label">Pilih Sarana</label>
                        <select class="form-select" id="bookingSarana" required>
                            <option value="">-- Pilih Sarana --</option>
                            <option value="Aula SMP">Aula SMP</option>
                            <option value="Aula SMA">Aula SMA</option>
                            <option value="Lapangan Futsal">Lapangan Futsal</option>
                            <option value="Labkom SD">Labkom SD</option>
                            <option value="Labkom SMP">Labkom SMP</option>
                            <option value="Labkom SMA">Labkom SMA</option>
                            <option value="Perpus SD">Perpus SD</option>
                            <option value="Perpus SMP">Perpus SMP</option>
                            <option value="Perpus SMA">Perpus SMA</option>
                            <option value="Kantin SMP">Kantin SMP</option>
                            <option value="Kantin SMA">Kantin SMA</option>
                            <option value="Masjid">Masjid</option>
                            <option value="Musholla SMA">Musholla SMA</option>
                            <option value="Lapangan Basket">Lapangan Basket</option>
                            <option value="Lapangan Volley">Lapangan Volley</option>
                            <option value="Lapangan Rumput">Lapangan Rumput</option>
                            <option value="Area Parkir Loby SMA">Area Parkir Loby SMA</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Nama PIC</label>
                        <input type="text" class="form-input" id="bookingPIC" placeholder="Nama lengkap" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">No HP</label>
                        <input type="tel" class="form-input" id="bookingPhone" placeholder="0812..." required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Tanggal Booking</label>
                        <input type="date" class="form-input" id="bookingDate" value="${today}" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Waktu Mulai</label>
                        <input type="time" class="form-input" id="bookingStart" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Waktu Selesai</label>
                        <input type="time" class="form-input" id="bookingEnd" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Catatan (Opsional)</label>
                        <textarea class="form-textarea" id="bookingNote" placeholder="Tambahkan catatan jika diperlukan..."></textarea>
                    </div>
                    
                    <div style="margin: 25px 0; padding: 15px; background: rgba(0,200,151,0.1); border-radius: 10px;">
                        <div style="color: var(--emerald); font-size: 0.9rem; font-weight: bold; margin-bottom: 5px;">
                            ${isConnected ? 'üü¢ Supabase Connected' : 'üì¥ Offline Mode'}
                        </div>
                        <div style="font-size: 0.8rem; color: rgba(255,255,255,0.6);">
                            Data akan ${isConnected ? 'disimpan ke database Supabase' : 'disimpan secara offline'}
                        </div>
                    </div>
                    
                    <button type="submit" class="form-submit">
                        ${isConnected ? 'üì° SIMPAN KE SUPABASE' : 'üíæ SIMPAN OFFLINE'}
                    </button>
                </form>
            `;
        }

        function getK3Form() {
            return `
                <div class="form-header">
                    <div class="form-title">
                        <span style="font-size: 2rem;">üõ°Ô∏è</span>
                        <div>LAPORAN K3</div>
                    </div>
                    <button class="close-modal" onclick="closeModal()">√ó</button>
                </div>
                
                <form onsubmit="submitK3Form(event)">
                    <div class="form-group">
                        <label class="form-label">Jenis Laporan</label>
                        <select class="form-select" id="k3Type" required>
                            <option value="Kerusakan">Kerusakan ‚Üí Maintenance</option>
                            <option value="Kehilangan">Kehilangan ‚Üí Sekuriti</option>
                            <option value="Kebersihan">Kebersihan ‚Üí CS</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Lokasi</label>
                        <input type="text" class="form-input" id="k3Location" placeholder="Contoh: Aula SMA" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Nama Pelapor</label>
                        <input type="text" class="form-input" id="k3Reporter" placeholder="Nama lengkap" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">No HP Pelapor</label>
                        <input type="tel" class="form-input" id="k3Phone" placeholder="0812..." required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Deskripsi Masalah</label>
                        <textarea class="form-textarea" id="k3Description" placeholder="Jelaskan kejadian secara detail..." required rows="4"></textarea>
                    </div>
                    
                    <div style="margin: 25px 0; padding: 15px; background: rgba(239,68,68,0.1); border-radius: 10px;">
                        <div style="color: var(--danger); font-size: 0.9rem; font-weight: bold; margin-bottom: 5px;">
                            ‚ö†Ô∏è Prioritas Tinggi
                        </div>
                        <div style="font-size: 0.8rem; color: rgba(255,255,255,0.6);">
                            Laporan K3 akan segera ditindaklanjuti oleh tim terkait
                        </div>
                    </div>
                    
                    <button type="submit" class="form-submit" style="background: var(--danger);">
                        üö® KIRIM LAPORAN K3
                    </button>
                </form>
            `;
        }

        function getSecurityForm() {
            return `
                <div class="form-header">
                    <div class="form-title">
                        <span style="font-size: 2rem;">üëÆ</span>
                        <div>LAPORAN HARIAN SEKURITI</div>
                    </div>
                    <button class="close-modal" onclick="closeModal()">√ó</button>
                </div>
                
                <form onsubmit="submitSecurityForm(event)">
                    <div class="form-group">
                        <label class="form-label">Nama Petugas</label>
                        <input type="text" class="form-input" id="securityOfficer" placeholder="Nama petugas jaga" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Shift</label>
                        <select class="form-select" id="securityShift" required>
                            <option value="Pagi (07:00-19:00)">‚òÄÔ∏è Pagi (07:00‚Äì19:00)</option>
                            <option value="Malam (19:00-07:00)">üåô Malam (19:00‚Äì07:00)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Jenis Laporan</label>
                        <select class="form-select" id="securityType" required>
                            <option value="Patroli Rutin">Patroli Rutin</option>
                            <option value="Insiden">Insiden</option>
                            <option value="Penemuan Barang">Penemuan Barang</option>
                            <option value="Lainnya">Lainnya</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Lokasi</label>
                        <input type="text" class="form-input" id="securityLocation" placeholder="Lokasi kejadian" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Deskripsi Kegiatan</label>
                        <textarea class="form-textarea" id="securityDescription" placeholder="Tuliskan kegiatan patroli, temuan, dan keterangan..." rows="5"></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button type="button" class="form-submit" style="background: var(--warning); flex: 1; color: black;" onclick="exportToExcel()">
                            üìä EKSPOR KE EXCEL
                        </button>
                        <button type="submit" class="form-submit" style="flex: 1;">
                            üì° SIMPAN LAPORAN
                        </button>
                    </div>
                </form>
            `;
        }

        function getAdminForm() {
            return `
                <div class="form-header">
                    <div class="form-title">
                        <span style="font-size: 2rem;">üëë</span>
                        <div>ADMIN PANEL - SUPABASE MANAGER</div>
                    </div>
                    <button class="close-modal" onclick="closeModal()">√ó</button>
                </div>
                
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 5rem; margin-bottom: 30px;">üîê</div>
                    <h2 style="color: var(--gold); margin-bottom: 20px;">AKSES ADMIN TERVERIFIKASI</h2>
                    <p style="color: rgba(255,255,255,0.8); margin-bottom: 30px; line-height: 1.6;">
                        Welcome back, <strong>Mr. M Architect</strong>!<br>
                        System Status: <span style="color: ${isConnected ? 'var(--success)' : 'var(--danger)'}">
                            ${isConnected ? 'üü¢ Connected to Supabase' : 'üî¥ Offline Mode'}
                        </span>
                    </p>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 40px 0;">
                        <div style="background: rgba(0,200,151,0.1); padding: 20px; border-radius: 15px; text-align: center; cursor: pointer;" onclick="loadDashboardStats()">
                            <div style="font-size: 2rem;">üìä</div>
                            <div style="font-weight: bold; margin-top: 10px;">Refresh Stats</div>
                        </div>
                        <div style="background: rgba(59,130,246,0.1); padding: 20px; border-radius: 15px; text-align: center; cursor: pointer;" onclick="syncOfflineData()">
                            <div style="font-size: 2rem;">üîÑ</div>
                            <div style="font-weight: bold; margin-top: 10px;">Sync Offline Data</div>
                        </div>
                        <div style="background: rgba(139,92,246,0.1); padding: 20px; border-radius: 15px; text-align: center; cursor: pointer;" onclick="showNotification('Export feature coming soon!', 'info')">
                            <div style="font-size: 2rem;">üìà</div>
                            <div style="font-weight: bold; margin-top: 10px;">Export Data</div>
                        </div>
                        <div style="background: rgba(239,68,68,0.1); padding: 20px; border-radius: 15px; text-align: center; cursor: pointer;" onclick="initializeSupabase()">
                            <div style="font-size: 2rem;">‚öôÔ∏è</div>
                            <div style="font-weight: bold; margin-top: 10px;">Reconnect DB</div>
                        </div>
                    </div>
                    
                    <div style="margin: 30px 0; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 15px;">
                        <div style="color: var(--emerald); font-weight: bold; margin-bottom: 15px;">Database Information</div>
                        <div style="text-align: left; font-size: 0.9rem; color: rgba(255,255,255,0.7);">
                            <div>üìä Tables: 5 (bookings, k3_reports, security_reports, cs_reports, inventory)</div>
                            <div>üîå Connection: ${isConnected ? 'Active' : 'Offline'}</div>
                            <div>üóÉÔ∏è Offline Queue: ${offlineQueue.length} items</div>
                            <div>üïí Last Sync: Just now</div>
                        </div>
                    </div>
                    
                    <button class="form-submit" onclick="closeModal()" style="background: var(--gold); color: var(--dark);">
                        TUTUP PANEL
                    </button>
                </div>
            `;
        }

        function getCSForm() {
            return `
                <div class="form-header">
                    <div class="form-title">
                        <span style="font-size: 2rem;">üßπ</span>
                        <div>CEKLIS HARIAN CS</div>
                    </div>
                    <button class="close-modal" onclick="closeModal()">√ó</button>
                </div>
                
                <form onsubmit="submitCSForm(event)">
                    <div class="form-group">
                        <label class="form-label">Area yang Dibersihkan</label>
                        <select class="form-select" id="csArea" required>
                            <option value="">-- Pilih Area --</option>
                            <option value="Toilet">Toilet</option>
                            <option value="Lantai">Lantai</option>
                            <option value="Taman">Taman</option>
                            <option value="Ruang Kelas">Ruang Kelas</option>
                            <option value="Koridor">Koridor</option>
                            <option value="Kantin">Kantin</option>
                            <option value="Musholla">Musholla</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Waktu Pembersihan</label>
                        <input type="time" class="form-input" id="csTime" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Kondisi Area</label>
                        <select class="form-select" id="csCondition" required>
                            <option value="Bersih">‚úÖ Bersih</option>
                            <option value="Kotor">‚ùå Kotor</option>
                            <option value="Perlu Perbaikan">‚ö†Ô∏è Perlu Perbaikan</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Catatan</label>
                        <textarea class="form-textarea" id="csNotes" placeholder="Tambahkan catatan jika diperlukan..."></textarea>
                    </div>
                    
                    <button type="submit" class="form-submit" style="background: var(--success);">
                        ‚úÖ SIMPAN CEKLIS
                    </button>
                </form>
            `;
        }

        function getMaintenanceForm() {
            return `
                <div class="form-header">
                    <div class="form-title">
                        <span style="font-size: 2rem;">üîß</span>
                        <div>MAINTENANCE SARANA</div>
                    </div>
                    <button class="close-modal" onclick="closeModal()">√ó</button>
                </div>
                
                <form onsubmit="submitMaintenanceForm(event)">
                    <div class="form-group">
                        <label class="form-label">Jenis Sarana</label>
                        <select class="form-select" id="maintenanceItem" required>
                            <option value="">-- Pilih Sarana --</option>
                            <option value="Proyektor">Proyektor</option>
                            <option value="AC">AC</option>
                            <option value="Komputer">Komputer</option>
                            <option value="Pintu">Pintu</option>
                            <option value="Jendela">Jendela</option>
                            <option value="Listrik">Instalasi Listrik</option>
                            <option value="Pipa Air">Pipa Air</option>
                            <option value="Furniture">Furniture</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Lokasi</label>
                        <input type="text" class="form-input" id="maintenanceLocation" placeholder="Contoh: Labkom SMA" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Deskripsi Kerusakan</label>
                        <textarea class="form-textarea" id="maintenanceDescription" placeholder="Jelaskan kerusakan secara detail..." required rows="4"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Status Perbaikan</label>
                        <select class="form-select" id="maintenanceStatus" required>
                            <option value="Belum Diperbaiki">‚è≥ Belum Diperbaiki</option>
                            <option value="Sedang Diperbaiki">üîß Sedang Diperbaiki</option>
                            <option value="Sudah Diperbaiki">‚úÖ Sudah Diperbaiki</option>
                            <option value="Menunggu Part">‚åõ Menunggu Part</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="form-submit" style="background: var(--blue);">
                        üîß KIRIM LAPORAN MAINTENANCE
                    </button>
                </form>
            `;
        }

        function getStockForm() {
            return `
                <div class="form-header">
                    <div class="form-title">
                        <span style="font-size: 2rem;">üì¶</span>
                        <div>STOK & TOOLS CS</div>
                    </div>
                    <button class="close-modal" onclick="closeModal()">√ó</button>
                </div>
                
                <form onsubmit="submitStockForm(event)">
                    <div class="form-group">
                        <label class="form-label">Barang</label>
                        <select class="form-select" id="stockItem" required>
                            <option value="">-- Pilih Barang --</option>
                            <option value="Sabun Cair">Sabun Cair</option>
                            <option value="Lap Pel">Lap Pel</option>
                            <option value="Kantong Sampah">Kantong Sampah</option>
                            <option value="Cairan Pembersih">Cairan Pembersih</option>
                            <option value="Sapu">Sapu</option>
                            <option value="Pengki">Pengki</option>
                            <option value="Kemoceng">Kemoceng</option>
                            <option value="Sikat WC">Sikat WC</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Kategori</label>
                        <select class="form-select" id="stockCategory" required>
                            <option value="Pembersih">Pembersih</option>
                            <option value="Alat">Alat</option>
                            <option value="Bahan Habis Pakai">Bahan Habis Pakai</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Jumlah</label>
                        <input type="number" class="form-input" id="stockQuantity" placeholder="Contoh: 10" required min="1">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Area Distribusi</label>
                        <select class="form-select" id="stockLocation" required>
                            <option value="SD">SD Al Fikri</option>
                            <option value="SMP">SMP Al Fikri</option>
                            <option value="SMA">SMA Al Fikri</option>
                            <option value="Taman">Taman</option>
                            <option value="Kantor">Kantor</option>
                            <option value="Masjid">Masjid</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="form-submit" style="background: var(--purple);">
                        üì¶ SIMPAN DATA STOK
                    </button>
                </form>
            `;
        }

        function exportToExcel() {
            showNotification('üìä Export to Excel feature coming soon!', 'info');
        }

        // ================= INITIALIZATION =================
        window.addEventListener('load', () => {
            // Auto-focus pada password master
            setTimeout(() => {
                document.getElementById('masterPassword')?.focus();
            }, 500);

            // Load any existing offline data
            const bookingsOffline = localStorage.getItem('dreamos_bookings_offline');
            const k3Offline = localStorage.getItem('dreamos_k3_reports_offline');
            
            if (bookingsOffline) {
                offlineQueue = offlineQueue.concat(
                    JSON.parse(bookingsOffline).map(item => ({ table: 'bookings', data: item }))
                );
            }
            
            if (k3Offline) {
                offlineQueue = offlineQueue.concat(
                    JSON.parse(k3Offline).map(item => ({ table: 'k3_reports', data: item }))
                );
            }

            // Update connection status initially
            updateConnectionStatus(false);

            // Log startup
            console.log('%cüîê DREAM OS v13.3 ‚Äî Supabase Integrated System', 'color: #00C897; font-size: 18px; font-weight: bold;');
            console.log('%cPassword Master: Mr.M_Architect_2025', 'color: #FFD700;');
            console.log('%cSupabase URL: https://ywtpykgjvbjwhmapmygb.supabase.co', 'color: #3b82f6;');
        });

        // Listen for online/offline events
        window.addEventListener('online', () => {
            showNotification('üì° Koneksi internet pulih. Menyambungkan ke Supabase...', 'info');
            initializeSupabase();
        });

        window.addEventListener('offline', () => {
            showNotification('üì¥ Kehilangan koneksi. Beralih ke mode offline.', 'warning');
            updateConnectionStatus(false);
        });
    </script>

</body>
</html>
